{"version":3,"file":"AllureMochaReporter.js","names":["Mocha","_interopRequireWildcard","require","_nodePath","_nodeProcess","_allureJsCommons","_sdk","_reporter","_runtime","_MochaTestRuntime","_extraReporters2","_legacyUtils","_utils","_excluded","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","_t","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","_objectWithoutProperties","_objectWithoutPropertiesLoose","getOwnPropertySymbols","length","indexOf","propertyIsEnumerable","ownKeys","keys","filter","enumerable","push","apply","_objectSpread","arguments","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","_classPrivateFieldInitSpec","a","_checkPrivateRedeclaration","TypeError","_toPropertyKey","value","configurable","writable","_toPrimitive","Symbol","toPrimitive","String","Number","_classPrivateFieldGet","s","_assertClassBrand","_classPrivateFieldSet","EVENT_SUITE_BEGIN","EVENT_SUITE_END","EVENT_TEST_BEGIN","EVENT_TEST_END","EVENT_TEST_PASS","EVENT_TEST_FAIL","EVENT_TEST_PENDING","EVENT_HOOK_BEGIN","EVENT_HOOK_END","EVENT_TEST_RETRY","Runner","constants","_extraReporters","AllureMochaReporter","reporters","Base","constructor","runner","opts","_this","_opts$reporterOptions","isInWorker","undefined","this","Map","_this$currentHook","root","currentHook","currentTest","_len","message","Array","_key","runtime","applyRuntimeMessages","categories","writeCategoriesDefinitions","environmentInfo","writeEnvironmentInfo","name","content","options","_this$currentHook2","_opts$encoding","contentType","encoding","buffer","Buffer","from","writeAttachment","wrapInStep","on","onSuite","onSuiteEnd","onTest","onPassed","onFailed","onPending","onTestEnd","onHookStart","onHookEnd","suite","parent","testplan","applyTestPlan","idIndex","fullNameIndex","scopeUuid","startScope","scopesStack","writeTestScopes","pop","writeScope","test","retriedTest","testsMap","testScope","getTestScope","delete","globalLabels","getEnvironmentLabels","label","initialLabels","getLanguageLabel","getFrameworkLabel","getFrameworkName","getHostLabel","getThreadLabel","getWorkerId","metaLabels","getAllureMetaLabels","links","getAllureMetaLinks","labels","concat","file","packageLabel","getPackageLabel","setTestScope","retryNum","currentRetry","parameters","excluded","startTest","getAllureDisplayName","stage","Stage","RUNNING","fullName","getAllureFullName","testCaseId","getTestCaseId","updateTest","status","Status","PASSED","_","error","getStatusFromError","statusDetails","getMessageAndTraceFromError","isIncludedInTestRun","SKIPPED","defaultSuites","getSuitesOfMochaTest","fsPath","getRelativePath","split","sep","Boolean","ensureSuiteLabels","titlePath","FINISHED","stopTest","writeTest","hook","_hook$ctx","_ref","_hook$originalTitle","hookCategory","hookScope","getHookType","ctx","getCurrentSuiteScope","originalTitle","title","startFixture","updateFixture","stopFixture","tests","testScopeUuid","env","MOCHA_WORKER_ID","allureConfig","reporterOptions","resultsDir","extraReporters","restOptions","ReporterRuntime","writer","createDefaultWriter","createTestPlanIndices","testRuntime","MochaTestRuntime","setGlobalTestRuntime","setLegacyApiRuntime","parallel","_opts$require","resolveParallelModeSetupFile","applyListeners","enableExtraReporters","done","failures","fn","doneAll","exports"],"sources":["../../src/AllureMochaReporter.ts"],"sourcesContent":["import * as Mocha from \"mocha\";\nimport { sep } from \"node:path\";\nimport { env } from \"node:process\";\nimport { type AttachmentOptions, type ContentType, type Label, type Parameter } from \"allure-js-commons\";\nimport { Stage, Status } from \"allure-js-commons\";\nimport type { Category, RuntimeMessage } from \"allure-js-commons/sdk\";\nimport { getMessageAndTraceFromError, getStatusFromError } from \"allure-js-commons/sdk\";\nimport { getHostLabel, getRelativePath, getThreadLabel } from \"allure-js-commons/sdk/reporter\";\nimport {\n  ReporterRuntime,\n  createDefaultWriter,\n  ensureSuiteLabels,\n  getEnvironmentLabels,\n  getFrameworkLabel,\n  getLanguageLabel,\n  getPackageLabel,\n} from \"allure-js-commons/sdk/reporter\";\nimport { setGlobalTestRuntime } from \"allure-js-commons/sdk/runtime\";\nimport { MochaTestRuntime } from \"./MochaTestRuntime.js\";\nimport { doneAll, enableExtraReporters } from \"./extraReporters.js\";\nimport { setLegacyApiRuntime } from \"./legacyUtils.js\";\nimport type { AllureMochaReporterConfig, TestPlanIndices } from \"./types.js\";\nimport {\n  applyTestPlan,\n  createTestPlanIndices,\n  getAllureDisplayName,\n  getAllureFullName,\n  getAllureMetaLabels,\n  getAllureMetaLinks,\n  getHookType,\n  getSuitesOfMochaTest,\n  getTestCaseId,\n  getTestScope,\n  isIncludedInTestRun,\n  resolveParallelModeSetupFile,\n  setTestScope,\n} from \"./utils.js\";\n\nconst {\n  EVENT_SUITE_BEGIN,\n  EVENT_SUITE_END,\n  EVENT_TEST_BEGIN,\n  EVENT_TEST_END,\n  EVENT_TEST_PASS,\n  EVENT_TEST_FAIL,\n  EVENT_TEST_PENDING,\n  EVENT_HOOK_BEGIN,\n  EVENT_HOOK_END,\n  EVENT_TEST_RETRY,\n} = Mocha.Runner.constants;\n\nexport class AllureMochaReporter extends Mocha.reporters.Base {\n  protected readonly runtime: ReporterRuntime;\n  protected readonly testplan?: TestPlanIndices;\n  protected readonly testsMap: Map<string, Mocha.Test> = new Map();\n  protected scopesStack: string[] = [];\n  protected currentTest?: string;\n  protected currentHook?: string;\n  private readonly isInWorker: boolean;\n  readonly #extraReporters: Mocha.reporters.Base[] = [];\n\n  constructor(runner: Mocha.Runner, opts: Mocha.MochaOptions, isInWorker: boolean = false) {\n    super(runner, opts);\n\n    const allureConfig: AllureMochaReporterConfig = opts.reporterOptions ?? {};\n    const { resultsDir, extraReporters, ...restOptions } = allureConfig;\n\n    this.isInWorker = isInWorker;\n    this.runtime = new ReporterRuntime({\n      writer: createDefaultWriter({ resultsDir }),\n      ...restOptions,\n    });\n    this.testplan = createTestPlanIndices();\n\n    const testRuntime = new MochaTestRuntime(this.applyRuntimeMessages);\n\n    setGlobalTestRuntime(testRuntime);\n    setLegacyApiRuntime(this);\n\n    if (opts.parallel) {\n      opts.require = [...(opts.require ?? []), resolveParallelModeSetupFile()];\n    } else {\n      this.applyListeners();\n    }\n\n    if (!isInWorker && extraReporters) {\n      this.#extraReporters = enableExtraReporters(runner, opts, extraReporters);\n    }\n  }\n\n  applyRuntimeMessages = (...message: RuntimeMessage[]) => {\n    const root = this.currentHook ?? this.currentTest;\n    if (root) {\n      this.runtime.applyRuntimeMessages(root, message);\n    }\n  };\n\n  /**\n   * @deprecated for removal. Use reporter config option instead.\n   */\n  writeCategoriesDefinitions = (categories: Category[]) => {\n    this.runtime.categories = categories;\n    if (this.isInWorker) {\n      // done is not called in a worker; emit the file immediately\n      this.runtime.writeCategoriesDefinitions();\n    }\n  };\n\n  /**\n   * @deprecated for removal. Use reporter config option instead.\n   */\n  writeEnvironmentInfo = (environmentInfo: Record<string, string>) => {\n    this.runtime.environmentInfo = environmentInfo;\n    if (this.isInWorker) {\n      // done is not called in a worker; emit the file immediately\n      this.runtime.writeEnvironmentInfo();\n    }\n  };\n\n  /**\n   * @deprecated for removal. Use reporter config option instead.\n   */\n  testAttachment = (name: string, content: Buffer | string, options: ContentType | string | AttachmentOptions) => {\n    const root = this.currentHook ?? this.currentTest;\n    if (!root) {\n      return;\n    }\n    const opts = typeof options === \"string\" ? { contentType: options } : options;\n    const encoding = opts.encoding ?? \"utf8\";\n    const buffer = typeof content === \"string\" ? Buffer.from(content, encoding) : content;\n    this.runtime.writeAttachment(root, null, name, buffer, { ...opts, wrapInStep: false });\n  };\n\n  override done(failures: number, fn?: ((failures: number) => void) | undefined) {\n    this.runtime.writeEnvironmentInfo();\n    this.runtime.writeCategoriesDefinitions();\n    doneAll(this.#extraReporters, failures, fn);\n  }\n\n  private applyListeners = () => {\n    this.runner\n      .on(EVENT_SUITE_BEGIN, this.onSuite)\n      .on(EVENT_SUITE_END, this.onSuiteEnd)\n      .on(EVENT_TEST_BEGIN, this.onTest)\n      .on(EVENT_TEST_PASS, this.onPassed)\n      .on(EVENT_TEST_FAIL, this.onFailed)\n      .on(EVENT_TEST_RETRY, this.onFailed)\n      .on(EVENT_TEST_PENDING, this.onPending)\n      .on(EVENT_TEST_END, this.onTestEnd)\n      .on(EVENT_HOOK_BEGIN, this.onHookStart)\n      .on(EVENT_HOOK_END, this.onHookEnd);\n  };\n\n  private onSuite = (suite: Mocha.Suite) => {\n    if (!suite.parent && this.testplan) {\n      applyTestPlan(this.testplan.idIndex, this.testplan.fullNameIndex, suite);\n    }\n    const scopeUuid = this.runtime.startScope();\n    this.scopesStack.push(scopeUuid);\n  };\n\n  private onSuiteEnd = (suite: Mocha.Suite) => {\n    this.writeTestScopes(suite);\n    const scopeUuid = this.scopesStack.pop();\n    if (scopeUuid) {\n      this.runtime.writeScope(scopeUuid);\n    }\n  };\n\n  private onTest = (test: Mocha.Test) => {\n    if (this.currentTest) {\n      const retriedTest = this.testsMap.get(this.currentTest);\n      if (retriedTest) {\n        this.onTestEnd(retriedTest);\n        const testScope = getTestScope(retriedTest);\n        if (testScope) {\n          this.runtime.writeScope(testScope);\n        }\n      }\n      this.testsMap.delete(this.currentTest);\n      this.currentTest = undefined;\n    }\n\n    const globalLabels = getEnvironmentLabels().filter((label) => !!label.value);\n    const initialLabels: Label[] = [\n      getLanguageLabel(),\n      getFrameworkLabel(this.getFrameworkName()),\n      getHostLabel(),\n      getThreadLabel(this.getWorkerId()),\n    ];\n    const metaLabels = getAllureMetaLabels(test);\n    const links = getAllureMetaLinks(test);\n    const labels = globalLabels.concat(initialLabels, metaLabels);\n\n    if (test.file) {\n      const packageLabel: Label = getPackageLabel(test.file);\n\n      labels.push(packageLabel);\n    }\n\n    const scopeUuid = this.runtime.startScope();\n\n    setTestScope(test, scopeUuid);\n\n    // @ts-ignore\n    const retryNum = \"currentRetry\" in test ? test.currentRetry() : 0;\n    const parameters: Parameter[] = retryNum ? [{ name: \"Retry\", value: `${retryNum}`, excluded: true }] : [];\n\n    this.currentTest = this.runtime.startTest(\n      {\n        name: getAllureDisplayName(test),\n        stage: Stage.RUNNING,\n        fullName: getAllureFullName(test),\n        labels,\n        links: [...links],\n        testCaseId: getTestCaseId(test),\n        parameters: parameters,\n      },\n      [...this.scopesStack, scopeUuid],\n    );\n    this.testsMap.set(this.currentTest, test);\n  };\n\n  private onPassed = () => {\n    if (!this.currentTest) {\n      return;\n    }\n    this.runtime.updateTest(this.currentTest, (r) => {\n      r.status = Status.PASSED;\n    });\n  };\n\n  private onFailed = (_: Mocha.Test, error: Error) => {\n    if (!this.currentTest) {\n      return;\n    }\n    this.runtime.updateTest(this.currentTest, (r) => {\n      r.status = getStatusFromError(error);\n      r.statusDetails = {\n        ...r.statusDetails,\n        ...getMessageAndTraceFromError(error),\n      };\n    });\n  };\n\n  private onPending = (test: Mocha.Test) => {\n    if (isIncludedInTestRun(test)) {\n      if (!this.currentTest) {\n        this.onTest(test);\n      }\n      this.runtime.updateTest(this.currentTest!, (r) => {\n        r.status = Status.SKIPPED;\n        r.statusDetails = {\n          message: \"Test skipped\",\n        };\n      });\n    }\n  };\n\n  private onTestEnd = (test: Mocha.Test) => {\n    if (!this.currentTest) {\n      return;\n    }\n    if (isIncludedInTestRun(test)) {\n      const defaultSuites = getSuitesOfMochaTest(test);\n\n      this.runtime.updateTest(this.currentTest, (t) => {\n        const fsPath: string[] = getRelativePath(test.file!).split(sep).filter(Boolean);\n\n        ensureSuiteLabels(t, defaultSuites);\n\n        t.titlePath = fsPath.concat(...defaultSuites);\n        t.stage = Stage.FINISHED;\n      });\n      this.runtime.stopTest(this.currentTest);\n      this.runtime.writeTest(this.currentTest);\n      this.testsMap.delete(this.currentTest);\n      this.currentTest = undefined;\n\n      // We're writing the test's dedicated scope in onSuiteEnd instead of here\n      // because there might be afterEach hooks, which are reported after\n      // onTestEnd, not before.\n    }\n  };\n\n  private onHookStart = (hook: Mocha.Hook) => {\n    const [hookCategory, hookScope] = getHookType(hook);\n    const test = hook.ctx?.currentTest;\n    const scopeUuid = hookScope === \"each\" && test ? getTestScope(test) : this.getCurrentSuiteScope();\n    if (!scopeUuid) {\n      return;\n    }\n\n    const name = hook.originalTitle ?? hook.title ?? \"\";\n    if (hookCategory) {\n      this.currentHook = this.runtime.startFixture(scopeUuid, hookCategory, { name });\n    }\n  };\n\n  private onHookEnd = (hook: Mocha.Hook) => {\n    if (!this.currentHook) {\n      return;\n    }\n    this.runtime.updateFixture(this.currentHook, (r) => {\n      const error: Error | undefined = hook.error();\n      if (error) {\n        r.status = getStatusFromError(error);\n        r.statusDetails = {\n          ...r.statusDetails,\n          ...getMessageAndTraceFromError(error),\n        };\n      } else {\n        r.status = Status.PASSED;\n      }\n    });\n    this.runtime.stopFixture(this.currentHook);\n    this.currentHook = undefined;\n  };\n\n  private writeTestScopes = (suite: Mocha.Suite) => {\n    suite.tests.forEach((test) => {\n      const testScopeUuid = getTestScope(test);\n      if (testScopeUuid) {\n        this.runtime.writeScope(testScopeUuid);\n      }\n    });\n  };\n\n  private getCurrentSuiteScope = () =>\n    this.scopesStack.length > 0 ? this.scopesStack[this.scopesStack.length - 1] : undefined;\n\n  protected getFrameworkName = (): string => \"mocha\";\n\n  protected getWorkerId = (): string | undefined => env.MOCHA_WORKER_ID;\n}\n"],"mappings":"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","ignoreList":[]}